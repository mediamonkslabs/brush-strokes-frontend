{"version":3,"sources":["components/Canvas/Canvas.module.css","components/CustomCursor/CustomCursor.module.css","images/shadertoyNoise.png","images/empty.jpg","images/structure.jpg","workers/nn.worker.js","components/Loader/Loader.module.css","images/spinner.png","images/icons/mute.svg","images/icons/unmute.svg","images/cursor.svg","components/App/App.module.css","lib/canvas.ts","lib/frame.ts","lib/start-animation-frame.ts","lib/canvas-animator.ts","lib/OffscreenDrawableCanvas.ts","lib/dat-gui.ts","lib/ImageEffectRender.ts","shaders/blit.glsl","shaders/dynamics.glsl","shaders/input.glsl","lib/watercolor-effect.ts","components/Loader/index.ts","components/Loader/Loader.tsx","components/Canvas/index.ts","components/Canvas/Canvas.tsx","settings.ts","components/CustomCursor/index.ts","components/CustomCursor/CustomCursor.tsx","components/App/index.ts","components/App/App.tsx","index.js"],"names":["module","exports","canvasScaleContainer","canvasContainer","spinner","rotate","spinnerVisible","root","cursor","cursorVisible","__webpack_require__","p","addMethods","methods","w","Worker","name","ready","Promise","r","addEventListener","app","header","headerMenu","headerButton","get2DContext","canvas","ctx","getContext","Error","createCanvas","width","height","arguments","length","undefined","OffscreenCanvas","c","document","createElement","setAttribute","toString","createCanvasFromImageData","imageData","putImageData","scaleImage","imageCanvas","drawImage","getImageData","debugDrawImageData","offscreenCanvas","style","setProperty","data","startFrameCounter","callback","fps","startTime","cancelled","cancel","cancelAnimationFrame","rafId","window","requestAnimationFrame","frame","time","startAnimationFrame","CanvasAnimatorEvent","_createEventClass","Object","classCallCheck","this","possibleConstructorReturn","getPrototypeOf","apply","inherits","createEventClass","CanvasAnimator","_EventDispatcher","canvasWidth","canvasHeight","_this","call","currentFrame","frames","context","createClass","key","value","_this$frames","push","toConsumableArray","_this2","frameOffset","floored","Math","floor","dispatchEvent","types","UPDATE","image","clearRect","EventDispatcher","OffscreenDrawableCanvasEvent","OffscreenDrawableCanvas","targetEventContainer","eventScaleX","eventScaleY","isPointerDown","pointerId","brushSize","blur","maxStrokeLength","currentStrokeLength","previousPointerPosition","x","y","devicePixelRatio","clear","attachEventListeners","onPointerDown","bind","onPointerUp","onPointerMove","event","preventDefault","offsetX","offsetY","DRAW_COMPLETE","getCurrentImage","distance","hypot","drawLine","DRAW","_ref","_ref2","x1","y1","x2","y2","lineWidth","filter","concat","strokeStyle","lineJoin","lineCap","beginPath","moveTo","lineTo","stroke","closePath","fillStyle","fillRect","gui","GUI","useDatGui","_useState","useState","_useState2","slicedToArray","datGui","setDatGui","useEffect","domElement","parentElement","removeChild","useDatGuiFolder","folderName","open","keys","__folders","includes","folder","addFolder","useDatGuiValue","label","min","max","_useState3","_useState4","stateValue","setStateValue","existing","__controllers","reduce","acc","controller","objectSpread","defineProperty","object","add","onChange","newValue","ImageEffectRendererFrameBuffer","gl","type","WebGLRenderingContext","UNSIGNED_BYTE","format","RGBA","texture","frameBuffer","createTexture","resize","createFramebuffer","bindFramebuffer","FRAMEBUFFER","framebufferTexture2D","COLOR_ATTACHMENT0","TEXTURE_2D","bindTexture","pixelStorei","UNPACK_FLIP_Y_WEBGL","texImage2D","deleteFramebuffer","deleteTexture","ImageEffectRendererBuffer","textures","program","shader","posAttributeIndex","uvAttributeIndex","uniformGlobalTime","uniformTime","uniformResolution","frameBuffer0","frameBuffer1","slotIndex","clampHorizontal","clampVertical","flipY","useMipMap","console","warn","useProgram","getProgram","uniform1i","getUniformLocation","updateImage","updateTexture","getSrc","getTexture","getDest","uniform2f","texParameteri","TEXTURE_WRAP_S","CLAMP_TO_EDGE","REPEAT","TEXTURE_WRAP_T","TEXTURE_MAG_FILTER","LINEAR","TEXTURE_MIN_FILTER","LINEAR_MIPMAP_LINEAR","generateMipmap","uniform1f","z","uniform3f","uniform4f","fsSource","deleteProgram","createProgram","vs","createShader","VERTEX_SHADER","fs","FRAGMENT_SHADER","shaderSource","compileShader","success","getShaderParameter","COMPILE_STATUS","getShaderInfoLog","attachShader","linkProgram","getProgramParameter","LINK_STATUS","getProgramInfoLog","getAttribLocation","quadVBO","fb","getFrameBuffer","COLOR_BUFFER_BIT","activeTexture","TEXTURE0","bindBuffer","ARRAY_BUFFER","enableVertexAttribArray","vertexAttribPointer","FLOAT","drawArrays","TRIANGLE_STRIP","k","destruct","ImageEffectRenderer","container","animationLoop","createTemporaryUsed","requestAnimationID","canvasScale","mainBuffer","buffers","premultipliedAlpha","draw","i","vertices","Float32Array","createBuffer","bufferData","STATIC_DRAW","viewport","addImage","setUniformFloat","setUniformInt","setUniformVec2","setUniformVec3","setUniformVec4","ier","IERActive","MAX_IMAGE_EFFECT_RENDERERS","IERPool","sameShaderFound","getShaderSource","splice","appendChild","generateNDCQuad","clearColor","enable","BLEND","blendFunc","ONE","ONE_MINUS_SRC_ALPHA","stop","parentNode","index","indexOf","blit","dynamics","input","WatercolorEffect","canvasWrapper","imageEffectRenderer","frameReset","structureOffset","_loadState","_loadProgress","createTemporary","blitShader","getCanvas","pointerEvents","addBuffer","inputShader","loadImage","getBuffer","imgEmpty","SIMULATION_STEPS","dynamicsShader","imgNoise","getMainBuffer","imgStructure","update","progress","updateSize","buffer","url","slot","Image","crossOrigin","src","onload","canvasInput","canvasNN","random","Loader","react","className","styles","Canvas","canvasAnimator","setCanvasAnimator","drawableCanvas","setDrawableCanvas","_useState5","_useState6","loadingProgress","setLoadingProgress","_useState7","_useState8","isProcessing","setIsProcessing","canvasFitContainerRef","createRef","_useState9","_useState10","appWorker","setAppWorker","additionalFrames","additionalFramesStep","drawableFolder","_useState11","_useState12","waterColorEffect","setWaterColorEffect","listener","updateNNCanvas","removeEventListener","current","_ref3","updateInputCanvas","finish","_ref5","asyncToGenerator","regenerator_default","a","mark","_callee","_ref4","nextFrames","wrap","_context","prev","next","sent","addFrames","animate","_x","_callee2","worker","_context2","loadState","loadProgress","load","react_default","ref","components_Loader","alt","classNames","CustomCursor","children","cursorImage","cursorOffsetX","cursorOffsetY","rootRef","cursorRef","isPointerVisible","setPointerVisible","pointerMoveCallback","useCallback","pointerLeaveCallback","pointerEnterCallback","App","muted","setMuted","toggleMute","_useElementFit","useElementFit","CANVAS_WIDTH","CANVAS_HEIGHT","ScaleMode","CONTAIN","containerRef","top","left","onClick","unmute","mute","href","target","components_CustomCursor","components_Canvas","CANVAS_GUTTER","ReactDOM","render","components_App","getElementById"],"mappings":"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","file":"static/js/main.133630ab.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"canvasScaleContainer\":\"Canvas_canvasScaleContainer__1rQdP\",\"canvasContainer\":\"Canvas_canvasContainer__2QqR1\",\"spinner\":\"Canvas_spinner__2538x\",\"rotate\":\"Canvas_rotate__34PxN\",\"spinnerVisible\":\"Canvas_spinnerVisible__2tcPD\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"root\":\"CustomCursor_root__1_0fR\",\"cursor\":\"CustomCursor_cursor__19cVK\",\"cursorVisible\":\"CustomCursor_cursorVisible__1I-sY\"};","module.exports = __webpack_public_path__ + \"static/media/shadertoyNoise.7c756fce.png\";","module.exports = __webpack_public_path__ + \"static/media/empty.f6d111fe.jpg\";","module.exports = __webpack_public_path__ + \"static/media/structure.41919d7b.jpg\";","\n\t\t\t\tvar addMethods = require(\"../../node_modules/workerize-loader/dist/rpc-wrapper.js\")\n\t\t\t\tvar methods = [\"load\",\"next\"]\n\t\t\t\tmodule.exports = function() {\n\t\t\t\t\tvar w = new Worker(__webpack_public_path__ + \"cf8cc01e8ebb5d36de98.worker.js\", { name: \"[hash].worker.js\" })\n\t\t\t\t\taddMethods(w, methods)\n\t\t\t\t\tw.ready = new Promise(function(r) { w.addEventListener(\"ready\", function(){ r(w) }) })\n\t\t\t\t\treturn w\n\t\t\t\t}\n\t\t\t","// extracted by mini-css-extract-plugin\nmodule.exports = {\"root\":\"Loader_root__2xEwR\"};","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAYAAABw4pVUAAAACXBIWXMAAAsTAAALEwEAmpwYAAAFHGlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxNDUgNzkuMTYzNDk5LCAyMDE4LzA4LzEzLTE2OjQwOjIyICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIgeG1sbnM6cGhvdG9zaG9wPSJodHRwOi8vbnMuYWRvYmUuY29tL3Bob3Rvc2hvcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RFdnQ9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZUV2ZW50IyIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ0MgMjAxOSAoV2luZG93cykiIHhtcDpDcmVhdGVEYXRlPSIyMDE5LTA4LTEyVDE2OjA0OjI2LTA0OjAwIiB4bXA6TW9kaWZ5RGF0ZT0iMjAxOS0wOC0xMlQxNjowNDo0OS0wNDowMCIgeG1wOk1ldGFkYXRhRGF0ZT0iMjAxOS0wOC0xMlQxNjowNDo0OS0wNDowMCIgZGM6Zm9ybWF0PSJpbWFnZS9wbmciIHBob3Rvc2hvcDpDb2xvck1vZGU9IjMiIHBob3Rvc2hvcDpJQ0NQcm9maWxlPSJzUkdCIElFQzYxOTY2LTIuMSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDo4NGRjNDdiNC1iMWQ4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\"","module.exports = __webpack_public_path__ + \"static/media/mute.6ad13fb3.svg\";","module.exports = __webpack_public_path__ + \"static/media/unmute.56fd3ccf.svg\";","module.exports = __webpack_public_path__ + \"static/media/cursor.7b8e4782.svg\";","// extracted by mini-css-extract-plugin\nmodule.exports = {\"root\":\"App_root__1Jh3p\",\"app\":\"App_app__1IksY\",\"header\":\"App_header__2MS2l\",\"headerMenu\":\"App_headerMenu__S5uHZ\",\"headerButton\":\"App_headerButton__3wspi\"};","export function get2DContext<T extends HTMLCanvasElement>(canvas: T): CanvasRenderingContext2D;\nexport function get2DContext<T extends OffscreenCanvas>(\n  canvas: T,\n): OffscreenCanvasRenderingContext2D;\n\nexport function get2DContext(\n  canvas: HTMLCanvasElement | OffscreenCanvas,\n): CanvasRenderingContext2D | OffscreenCanvasRenderingContext2D {\n  const ctx = canvas.getContext('2d') as\n    | CanvasRenderingContext2D\n    | OffscreenCanvasRenderingContext2D;\n\n  if (ctx === null) {\n    throw new Error(`Unable to get 2d context for canvas`);\n  }\n\n  return ctx;\n}\n\nexport function createCanvas(\n  width: number,\n  height: number,\n  offScreen: true,\n): OffscreenCanvasRenderingContext2D;\nexport function createCanvas(\n  width: number,\n  height: number,\n  offScreen: false,\n): CanvasRenderingContext2D;\nexport function createCanvas(width: number, height: number): CanvasRenderingContext2D;\n\nexport function createCanvas(width: number, height: number, offScreen: boolean = false) {\n  if (offScreen === true) {\n    return get2DContext(new OffscreenCanvas(width, height));\n  }\n\n  const c = document.createElement('canvas');\n  c.setAttribute('width', width.toString());\n  c.setAttribute('height', height.toString());\n\n  return get2DContext(c);\n}\n\nexport const createCanvasFromImageData = (imageData: ImageData): CanvasRenderingContext2D => {\n  const ctx = createCanvas(imageData.width, imageData.height);\n  ctx.putImageData(imageData, 0, 0);\n\n  return ctx;\n};\n\nexport const scaleImage = (imageData: ImageData, width: number, height: number): ImageData => {\n  const ctx = createCanvas(width, height);\n\n  const imageCanvas = createCanvasFromImageData(imageData);\n\n  ctx.drawImage(imageCanvas.canvas, 0, 0, width, height);\n\n  return ctx.getImageData(0, 0, width, height);\n};\n\nexport const debugDrawImageData = (() => {\n  const offscreenCanvas = document.createElement('canvas');\n  offscreenCanvas.style.setProperty('position', 'absolute');\n  offscreenCanvas.style.setProperty('z-index', '999999');\n  offscreenCanvas.style.setProperty('top', '0');\n  offscreenCanvas.style.setProperty('left', '0');\n  offscreenCanvas.style.setProperty('pointer-events', 'none');\n\n  if (process.env.NODE_ENV === 'development') {\n    document.body.appendChild(offscreenCanvas);\n  }\n\n  return (data: ImageData) => {\n    if (process.env.NODE_ENV === 'development') {\n      offscreenCanvas.setAttribute('width', data.width.toString());\n      offscreenCanvas.setAttribute('height', data.height.toString());\n      offscreenCanvas.style.setProperty('width', `${data.width / 10}px`);\n      offscreenCanvas.style.setProperty('height', `${data.height / 10}px`);\n      const ctx = get2DContext(offscreenCanvas);\n      ctx.clearRect(0, 0, data.width, data.height);\n\n      ctx.putImageData(data, 0, 0, 0, 0, data.width, data.height);\n    }\n  };\n})();\n\nexport const applyBackground = (imageData: ImageData, background: string): ImageData => {\n  const outCanvas = createCanvas(imageData.width, imageData.height);\n  const imageCanvas = createCanvasFromImageData(imageData);\n\n  outCanvas.fillStyle = background;\n  outCanvas.fillRect(0, 0, imageData.width, imageData.height);\n  outCanvas.drawImage(imageCanvas.canvas, 0, 0);\n\n  return outCanvas.getImageData(0, 0, imageData.width, imageData.height);\n};\n","import { startAnimationFrame } from './start-animation-frame';\n\nexport const startFrameCounter = (\n  callback: (time: number, cancel: () => void) => void,\n  fps: number = 60,\n): (() => void) => {\n  return startAnimationFrame((time, cancel) => {\n    callback((fps / 1000) * time, cancel);\n  });\n};\n","export const startAnimationFrame = (\n  callback: (time: number, cancel: () => void) => any,\n): (() => void) => {\n  let startTime: number | undefined;\n  let cancelled = false;\n  const cancel = () => {\n    cancelAnimationFrame(rafId);\n    cancelled = true;\n  };\n  let rafId: number = -1;\n\n  const frame = (time: number) => {\n    if (startTime === undefined) {\n      startTime = time;\n    }\n    if (cancelled) {\n      return;\n    }\n\n    rafId = window.requestAnimationFrame(frame);\n    callback(time - startTime, cancel);\n  };\n\n  rafId = window.requestAnimationFrame(frame);\n\n  return cancel;\n};\n","import EventDispatcher, { createEventClass } from 'seng-event';\nimport { createCanvas } from './canvas';\nimport { startFrameCounter } from './frame';\n\nexport class CanvasAnimatorEvent extends createEventClass<HTMLCanvasElement>()('UPDATE') {}\n\nexport class CanvasAnimator extends EventDispatcher {\n  private currentFrame = 0;\n  private frames: Array<ImageData> = [];\n  private context: CanvasRenderingContext2D;\n\n  constructor(private canvasWidth: number, private canvasHeight: number) {\n    super();\n    this.context = createCanvas(canvasWidth, canvasHeight);\n  }\n\n  public addFrames(frames: Array<ImageData>) {\n    this.frames.push(...frames);\n  }\n\n  public animate() {\n    const frameOffset = this.currentFrame;\n\n    startFrameCounter((frame, cancel) => {\n      const floored = Math.floor(frame + frameOffset);\n\n      if (this.frames[floored] === undefined) {\n        this.currentFrame = floored;\n        cancel();\n        return;\n      }\n\n      // prevent rendering of the same frame\n      if (floored === this.currentFrame) {\n        return;\n      }\n\n      this.currentFrame = floored;\n      this.drawImage(this.frames[floored]);\n      this.dispatchEvent(\n        new CanvasAnimatorEvent(CanvasAnimatorEvent.types.UPDATE, this.context.canvas),\n      );\n    }, 15);\n  }\n\n  public drawImage(image: ImageData) {\n    this.context.clearRect(0, 0, this.context.canvas.width, this.context.canvas.height);\n    this.context.putImageData(\n      image,\n      0,\n      0,\n      0,\n      0,\n      this.context.canvas.width,\n      this.context.canvas.height,\n    );\n  }\n}\n","import { get2DContext, scaleImage } from './canvas';\nimport EventDispatcher, { createEventClass } from 'seng-event';\n\ninterface Point {\n  x: number;\n  y: number;\n}\n\nexport class OffscreenDrawableCanvasEvent extends createEventClass<ImageData>()(\n  'DRAW',\n  'DRAW_COMPLETE',\n) {}\n\nexport class OffscreenDrawableCanvas extends EventDispatcher {\n  private isPointerDown = false;\n\n  private context: OffscreenCanvasRenderingContext2D;\n  private pointerId: number | undefined;\n\n  public brushSize: number = 5;\n  public blur: number = 5;\n  public maxStrokeLength = 250;\n\n  private currentStrokeLength: number = 0;\n  private previousPointerPosition: Point = {\n    x: -1,\n    y: -1,\n  };\n\n  constructor(\n    private readonly targetEventContainer: HTMLElement,\n    private readonly canvasWidth: number,\n    private readonly canvasHeight: number,\n    public eventScaleX: number,\n    public eventScaleY: number,\n  ) {\n    super();\n\n    this.context = get2DContext(\n      new OffscreenCanvas(canvasWidth * devicePixelRatio, canvasHeight * devicePixelRatio),\n    );\n\n    this.clear();\n\n    this.attachEventListeners();\n  }\n\n  private attachEventListeners() {\n    const onPointerDown = this.onPointerDown.bind(this);\n    const onPointerUp = this.onPointerUp.bind(this);\n    const onPointerMove = this.onPointerMove.bind(this);\n\n    this.targetEventContainer.addEventListener('pointerdown', onPointerDown);\n    this.targetEventContainer.addEventListener('pointerup', onPointerUp);\n    this.targetEventContainer.addEventListener('pointermove', onPointerMove);\n  }\n\n  private onPointerDown(event: PointerEvent) {\n    if (this.isPointerDown === true) {\n      return;\n    }\n    event.preventDefault();\n    this.pointerId = event.pointerId;\n\n    this.isPointerDown = true;\n    this.currentStrokeLength = 0;\n    this.previousPointerPosition.x = event.offsetX * devicePixelRatio;\n    this.previousPointerPosition.y = event.offsetY * devicePixelRatio;\n  }\n\n  private onPointerUp(event: PointerEvent) {\n    if (this.isPointerDown === false || this.pointerId !== event.pointerId) {\n      return;\n    }\n\n    event.preventDefault();\n\n    this.isPointerDown = false;\n\n    this.dispatchEvent(\n      new OffscreenDrawableCanvasEvent(\n        OffscreenDrawableCanvasEvent.types.DRAW_COMPLETE,\n        this.getCurrentImage(),\n      ),\n    );\n\n    this.clear();\n  }\n\n  public getCurrentImage() {\n    return scaleImage(\n      this.context.getImageData(0, 0, this.context.canvas.width, this.context.canvas.height),\n      this.context.canvas.width / devicePixelRatio,\n      this.context.canvas.height / devicePixelRatio,\n    );\n  }\n\n  private onPointerMove(event: PointerEvent) {\n    if (this.isPointerDown === false || this.pointerId !== event.pointerId) {\n      return;\n    }\n    event.preventDefault();\n\n    const x = event.offsetX * devicePixelRatio;\n    const y = event.offsetY * devicePixelRatio;\n\n    const distance =\n      this.currentStrokeLength +\n      Math.hypot(\n        this.previousPointerPosition.x / this.eventScaleX - x / this.eventScaleX,\n        this.previousPointerPosition.y / this.eventScaleY - y / this.eventScaleY,\n      );\n\n    this.currentStrokeLength = distance;\n\n    if (distance > this.maxStrokeLength) {\n      return;\n    }\n\n    this.drawLine(\n      {\n        x: this.previousPointerPosition.x / this.eventScaleX,\n        y: this.previousPointerPosition.y / this.eventScaleY,\n      },\n      { x: x / this.eventScaleX, y: y / this.eventScaleY },\n    );\n\n    this.dispatchEvent(\n      new OffscreenDrawableCanvasEvent(\n        OffscreenDrawableCanvasEvent.types.DRAW,\n        scaleImage(\n          this.context.getImageData(0, 0, this.context.canvas.width, this.context.canvas.height),\n          this.context.canvas.width / devicePixelRatio,\n          this.context.canvas.height / devicePixelRatio,\n        ),\n      ),\n    );\n\n    this.previousPointerPosition = { x, y };\n  }\n\n  private drawLine({ x: x1, y: y1 }: Point, { x: x2, y: y2 }: Point) {\n    this.context.lineWidth = this.brushSize * devicePixelRatio;\n    this.context.filter = `blur(${this.blur}px)`;\n    this.context.strokeStyle = '#000000';\n    this.context.lineJoin = this.context.lineCap = 'round';\n    this.context.beginPath();\n    this.context.moveTo(x1, y1);\n    this.context.lineTo(x2, y2);\n    this.context.stroke();\n    this.context.closePath();\n  }\n\n  private clear() {\n    this.context.fillStyle = 'white';\n    this.context.fillRect(0, 0, this.context.canvas.width, this.context.canvas.height);\n    this.context.lineWidth = this.brushSize * devicePixelRatio;\n    this.context.filter = `blur(${this.blur}px)`;\n  }\n}\n","import { useEffect, useState } from 'react';\nimport { GUI, GUIController } from 'dat-gui';\n\nlet gui: GUI = new GUI({ name: 'My GUI' });\n\nexport const useDatGui = (): GUI | null => {\n  const [datGui, setDatGui] = useState<GUI | null>(gui);\n  useEffect(() => {\n    if (datGui === null) {\n      gui = new GUI({ name: 'My GUI', width: 0 });\n      setDatGui(gui);\n    }\n  }, [datGui]);\n\n  if (\n    process.env.REACT_APP_HIDE_DAT_GUI !== undefined &&\n    datGui !== null &&\n    datGui.domElement.parentElement !== null\n  ) {\n    datGui.domElement.parentElement.removeChild(datGui.domElement);\n  }\n\n  return datGui;\n};\n\nexport const useDatGuiFolder = (folderName: string, open?: boolean): GUI | null => {\n  const gui = useDatGui();\n  if (gui !== null) {\n    if (Object.keys(gui.__folders).includes(folderName)) {\n      return gui.__folders[folderName as any];\n    } else {\n      const folder = gui.addFolder(folderName);\n      if (open === true) {\n        folder.open();\n\n        return folder;\n      }\n    }\n  }\n\n  return null;\n};\n\nexport function useDatGuiValue<TValue>(folder: GUI | null, value: TValue, label: string): TValue;\nexport function useDatGuiValue<TValue>(\n  folder: GUI | null,\n  value: TValue,\n  label: string,\n  min: number,\n  max: number,\n): TValue;\nexport function useDatGuiValue<TValue>(\n  folder: GUI | null,\n  value: TValue,\n  label: string,\n  status: boolean,\n): TValue;\nexport function useDatGuiValue<TValue>(\n  folder: GUI | null,\n  value: TValue,\n  label: string,\n  items: string[],\n): TValue;\nexport function useDatGuiValue<TValue>(\n  folder: GUI | null,\n  value: TValue,\n  label: string,\n  items: number[],\n): TValue;\nexport function useDatGuiValue<TValue>(\n  folder: GUI | null,\n  value: TValue,\n  label: string,\n  items: Object,\n): TValue;\n\nexport function useDatGuiValue(\n  folder: GUI | null,\n  value: number,\n  label: string,\n  min?: number | boolean | string[] | Object,\n  max?: number,\n) {\n  const [stateValue, setStateValue] = useState<typeof value>(value);\n\n  if (folder === null) {\n    return null;\n  }\n\n  const existing: { [key: string]: GUIController } = folder.__controllers.reduce(\n    (acc, controller) => ({ ...acc, [Object.keys((controller as any).object)[0]]: controller }),\n    {},\n  );\n\n  let controller: GUIController | null = null;\n\n  if (existing[label] === undefined) {\n    controller = folder.add({ [label]: value }, label, min as any, max as any);\n  } else {\n    controller = existing[label];\n  }\n\n  if (controller === null) {\n    return null;\n  }\n\n  controller.onChange((newValue: typeof value) => setStateValue(newValue));\n\n  return stateValue;\n}\n","class ImageEffectRendererFrameBuffer {\n  // webgl\n  private gl: WebGLRenderingContext;\n  private width: number = 0;\n  private height: number = 0;\n\n  private format: number = WebGLRenderingContext.RGBA;\n  private type: number = WebGLRenderingContext.UNSIGNED_BYTE;\n\n  private texture: WebGLTexture | null;\n  private frameBuffer: WebGLFramebuffer | null;\n\n  constructor(gl: WebGLRenderingContext, type: number = WebGLRenderingContext.UNSIGNED_BYTE) {\n    this.gl = gl;\n    this.type = type;\n\n    this.texture = this.gl.createTexture();\n    this.resize(16, 16);\n\n    this.frameBuffer = this.gl.createFramebuffer();\n    this.gl.bindFramebuffer(this.gl.FRAMEBUFFER, this.frameBuffer);\n    this.gl.framebufferTexture2D(\n      this.gl.FRAMEBUFFER,\n      this.gl.COLOR_ATTACHMENT0,\n      this.gl.TEXTURE_2D,\n      this.texture,\n      0,\n    );\n  }\n\n  public getTexture(): WebGLTexture {\n    return this.texture as WebGLTexture;\n  }\n\n  public getFrameBuffer(): WebGLFramebuffer {\n    return this.frameBuffer as WebGLFramebuffer;\n  }\n\n  public resize(width: number, height: number) {\n    if (this.width === width && this.height === height) {\n      return;\n    }\n    this.width = width;\n    this.height = height;\n\n    // this.gl.activeTexture(GL.TEXTURE0);\n    this.gl.bindTexture(this.gl.TEXTURE_2D, this.texture);\n    this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL, 0);\n    this.gl.texImage2D(\n      this.gl.TEXTURE_2D,\n      0,\n      this.format,\n      this.width,\n      this.height,\n      0,\n      this.format,\n      this.type,\n      null,\n    );\n  }\n\n  public destruct() {\n    if (this.frameBuffer) {\n      this.gl.deleteFramebuffer(this.frameBuffer);\n    }\n    if (this.texture) {\n      this.gl.deleteTexture(this.texture);\n    }\n\n    this.frameBuffer = null;\n    this.texture = null;\n  }\n}\n\nexport class ImageEffectRendererBuffer {\n  // webgl\n  private gl: WebGLRenderingContext;\n  public width: number = 0;\n  public height: number = 0;\n  private frame: number = 0;\n\n  // image input\n  private textures: (WebGLTexture | ImageEffectRendererBuffer)[] = []; // <slotIndex> = texture ID\n\n  // shader\n  private program!: WebGLProgram | null;\n  private shader!: string;\n  private posAttributeIndex!: number;\n  private uvAttributeIndex!: number;\n\n  // uniform\n  private uniformGlobalTime!: WebGLUniformLocation;\n  private uniformTime!: WebGLUniformLocation;\n  private uniformResolution!: WebGLUniformLocation;\n\n  // buffers\n  private frameBuffer0!: ImageEffectRendererFrameBuffer | null;\n  private frameBuffer1!: ImageEffectRendererFrameBuffer | null;\n\n  constructor(gl: WebGLRenderingContext, type: number = -1) {\n    this.gl = gl;\n\n    if (type >= 0) {\n      this.frameBuffer0 = new ImageEffectRendererFrameBuffer(gl, type);\n      this.frameBuffer1 = new ImageEffectRendererFrameBuffer(gl, type);\n    }\n  }\n\n  public addImage(\n    image: HTMLImageElement | HTMLCanvasElement | HTMLVideoElement | ImageEffectRendererBuffer,\n    slotIndex: number,\n    clampHorizontal: boolean = true,\n    clampVertical: boolean = true,\n    flipY: boolean = false,\n    useMipMap: boolean = false,\n  ): void {\n    if (slotIndex >= 4) {\n      console.warn(\n        'ImageEffectRenderer: A maximum of 4 slots is available, slotIndex is out of bounds.',\n      );\n    }\n\n    if (this.textures[slotIndex]) {\n      console.warn(\n        'ImageEffectRenderer: Image already added to slot ' +\n          slotIndex +\n          '. Use updateImage if you want to update an existing slot.',\n      );\n    }\n\n    if (image instanceof ImageEffectRendererBuffer) {\n      this.textures[slotIndex] = image;\n    } else {\n      this.textures[slotIndex] = this.gl.createTexture() as WebGLTexture;\n    }\n\n    this.gl.useProgram(this.getProgram());\n    this.gl.uniform1i(\n      this.gl.getUniformLocation(this.getProgram(), 'iChannel' + slotIndex),\n      slotIndex,\n    );\n\n    this.updateImage(image, slotIndex, clampHorizontal, clampVertical, flipY, useMipMap);\n  }\n\n  public updateImage(\n    image: HTMLImageElement | HTMLCanvasElement | HTMLVideoElement | ImageEffectRendererBuffer,\n    slotIndex: number,\n    clampHorizontal: boolean = true,\n    clampVertical: boolean = true,\n    flipY: boolean = false,\n    useMipMap: boolean = false,\n  ): void {\n    if (image instanceof ImageEffectRendererBuffer) {\n      this.updateTexture(\n        image,\n        (image as ImageEffectRendererBuffer).getSrc().getTexture(),\n        slotIndex,\n        clampHorizontal,\n        clampVertical,\n        useMipMap,\n      );\n      this.updateTexture(\n        image,\n        (image as ImageEffectRendererBuffer).getDest().getTexture(),\n        slotIndex,\n        clampHorizontal,\n        clampVertical,\n        useMipMap,\n      );\n    } else {\n      this.gl.bindTexture(this.gl.TEXTURE_2D, this.textures[slotIndex] as WebGLTexture);\n      this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL, flipY ? 1 : 0);\n      this.gl.texImage2D(\n        this.gl.TEXTURE_2D,\n        0,\n        this.gl.RGBA,\n        this.gl.RGBA,\n        this.gl.UNSIGNED_BYTE,\n        image,\n      );\n      this.updateTexture(\n        image,\n        this.textures[slotIndex] as WebGLTexture,\n        slotIndex,\n        clampHorizontal,\n        clampVertical,\n        useMipMap,\n      );\n    }\n  }\n\n  private updateTexture(\n    image: HTMLImageElement | HTMLCanvasElement | HTMLVideoElement | ImageEffectRendererBuffer,\n    texture: WebGLTexture,\n    slotIndex: number,\n    clampHorizontal: boolean = true,\n    clampVertical: boolean = true,\n    useMipMap: boolean = false,\n  ): void {\n    this.gl.bindTexture(this.gl.TEXTURE_2D, texture);\n    this.gl.uniform2f(\n      this.gl.getUniformLocation(this.getProgram(), 'iChannelResolution' + slotIndex),\n      image.width,\n      image.height,\n    );\n    this.gl.texParameteri(\n      this.gl.TEXTURE_2D,\n      this.gl.TEXTURE_WRAP_S,\n      clampHorizontal ? this.gl.CLAMP_TO_EDGE : this.gl.REPEAT,\n    );\n    this.gl.texParameteri(\n      this.gl.TEXTURE_2D,\n      this.gl.TEXTURE_WRAP_T,\n      clampVertical ? this.gl.CLAMP_TO_EDGE : this.gl.REPEAT,\n    );\n    this.gl.texParameteri(this.gl.TEXTURE_2D, this.gl.TEXTURE_MAG_FILTER, this.gl.LINEAR);\n    if (useMipMap) {\n      this.gl.texParameteri(\n        this.gl.TEXTURE_2D,\n        this.gl.TEXTURE_MIN_FILTER,\n        this.gl.LINEAR_MIPMAP_LINEAR,\n      );\n      this.gl.generateMipmap(this.gl.TEXTURE_2D);\n    } else {\n      this.gl.texParameteri(this.gl.TEXTURE_2D, this.gl.TEXTURE_MIN_FILTER, this.gl.LINEAR);\n    }\n  }\n\n  public setUniformFloat(name: string, value: number): void {\n    this.gl.useProgram(this.program);\n    this.gl.uniform1f(this.gl.getUniformLocation(this.getProgram(), name), value);\n  }\n\n  public setUniformInt(name: string, value: number): void {\n    this.gl.useProgram(this.program);\n    this.gl.uniform1i(this.gl.getUniformLocation(this.getProgram(), name), value);\n  }\n\n  public setUniformVec2(name: string, x: number, y: number): void {\n    this.gl.useProgram(this.program);\n    this.gl.uniform2f(this.gl.getUniformLocation(this.getProgram(), name), x, y);\n  }\n\n  public setUniformVec3(name: string, x: number, y: number, z: number): void {\n    this.gl.useProgram(this.program);\n    this.gl.uniform3f(this.gl.getUniformLocation(this.getProgram(), name), x, y, z);\n  }\n\n  public setUniformVec4(name: string, x: number, y: number, z: number, w: number): void {\n    this.gl.useProgram(this.program);\n    this.gl.uniform4f(this.gl.getUniformLocation(this.getProgram(), name), x, y, z, w);\n  }\n\n  public compileShader(fsSource: string): void {\n    if (this.shader !== fsSource) {\n      if (this.program) {\n        this.gl.deleteProgram(this.program);\n        this.program = null;\n      }\n      this.shader = fsSource;\n    } else {\n      return;\n    }\n\n    this.program = this.gl.createProgram();\n\n    const vs = this.gl.createShader(this.gl.VERTEX_SHADER) as WebGLShader;\n    const fs = this.gl.createShader(this.gl.FRAGMENT_SHADER) as WebGLShader;\n\n    // vertex shader\n    const vsSource: string = `\n            attribute vec2 aPos;\n            attribute vec2 aUV;\n            \n            varying vec2 vUV0;\n            \n            void main(void) {\n                vUV0 = aUV;\n                gl_Position = vec4(aPos, 0.0, 1.0);\n            }\n        `;\n    this.gl.shaderSource(vs, vsSource);\n    this.gl.compileShader(vs);\n\n    let success = this.gl.getShaderParameter(vs, this.gl.COMPILE_STATUS);\n    if (!success) {\n      throw new Error(\n        `ImageEffectRenderer: Vertex shader compilation failed: ${this.gl.getShaderInfoLog(vs)}`,\n      );\n    }\n\n    // fragment shader\n    const fsMainSource: string = `\n            #ifdef GL_ES\n                precision highp float;\n            #endif\n            \n            varying vec2 vUV0;\n            \n            uniform vec2 iResolution;\n            uniform float iTime;\n            uniform float iGlobalTime;\n            uniform vec4 iMouse;\n            \n            uniform highp sampler2D iChannel0;\n            uniform highp sampler2D iChannel1;\n            uniform highp sampler2D iChannel2;\n            uniform highp sampler2D iChannel3;\n            \n            uniform vec2 iChannelResolution0;\n            uniform vec2 iChannelResolution1;\n            uniform vec2 iChannelResolution2;\n            uniform vec2 iChannelResolution3;\n            \n            void mainImage(out vec4, vec2);\n            \n            vec4 texture(sampler2D tex, vec2 uv) {\n                return texture2D(tex, uv);\n            }\n            \n            void main(void) {\n            \tgl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\n                mainImage(gl_FragColor, gl_FragCoord.xy);\n            }\n        `;\n    this.gl.shaderSource(fs, fsMainSource + fsSource);\n    this.gl.compileShader(fs);\n\n    success = this.gl.getShaderParameter(fs, this.gl.COMPILE_STATUS);\n    if (!success) {\n      throw new Error(\n        `ImageEffectRenderer: Shader compilation failed: ${this.gl.getShaderInfoLog(fs)}`,\n      );\n    }\n\n    // link shaders\n    this.gl.attachShader(this.getProgram(), vs);\n    this.gl.attachShader(this.getProgram(), fs);\n    this.gl.linkProgram(this.getProgram());\n\n    success = this.gl.getProgramParameter(this.getProgram(), this.gl.LINK_STATUS);\n    if (!success) {\n      throw new Error(\n        `ImageEffectRenderer: Program linking failed: ${this.gl.getProgramInfoLog(\n          this.getProgram(),\n        )}`,\n      );\n    }\n\n    // get attribute locations\n    this.posAttributeIndex = this.gl.getAttribLocation(this.getProgram(), 'aPos');\n    this.uvAttributeIndex = this.gl.getAttribLocation(this.getProgram(), 'aUV');\n\n    // get uniform locations\n    this.gl.useProgram(this.program);\n    this.uniformGlobalTime = this.gl.getUniformLocation(\n      this.getProgram(),\n      'iGlobalTime',\n    ) as WebGLUniformLocation;\n    this.uniformTime = this.gl.getUniformLocation(\n      this.getProgram(),\n      'iTime',\n    ) as WebGLUniformLocation;\n    this.uniformResolution = this.gl.getUniformLocation(\n      this.getProgram(),\n      'iResolution',\n    ) as WebGLUniformLocation;\n  }\n\n  public getSrc(): ImageEffectRendererFrameBuffer {\n    return (this.frame % 2 === 0\n      ? this.frameBuffer0\n      : this.frameBuffer1) as ImageEffectRendererFrameBuffer;\n  }\n\n  public getDest(): ImageEffectRendererFrameBuffer {\n    return (this.frame % 2 === 1\n      ? this.frameBuffer0\n      : this.frameBuffer1) as ImageEffectRendererFrameBuffer;\n  }\n\n  /**\n   * Draw the new Canvas Frame, can be used to manually update the canvas when a Uniform has changed\n   *\n   * @param time\n   */\n  public draw(quadVBO: WebGLBuffer, time: number = 0, width: number, height: number): void {\n    this.width = width | 0;\n    this.height = height | 0;\n\n    const fb = this.getDest();\n    if (fb) {\n      fb.resize(this.width, this.height);\n      this.gl.bindFramebuffer(this.gl.FRAMEBUFFER, fb.getFrameBuffer());\n    }\n\n    // clear\n    this.gl.clear(this.gl.COLOR_BUFFER_BIT);\n    this.gl.useProgram(this.program);\n\n    // global uniforms\n    this.gl.uniform1f(this.uniformGlobalTime, time);\n    this.gl.uniform1f(this.uniformTime, time);\n    this.gl.uniform2f(this.uniformResolution, width, height);\n\n    // texture/channel uniforms\n    for (let slotIndex: number = 0; slotIndex < this.textures.length; ++slotIndex) {\n      this.gl.activeTexture(this.gl.TEXTURE0 + slotIndex);\n      if (this.textures[slotIndex] instanceof ImageEffectRendererBuffer) {\n        this.gl.bindTexture(\n          this.gl.TEXTURE_2D,\n          (this.textures[slotIndex] as ImageEffectRendererBuffer).getSrc().getTexture(),\n        );\n      } else {\n        this.gl.bindTexture(this.gl.TEXTURE_2D, this.textures[slotIndex] as WebGLTexture);\n      }\n    }\n\n    // render NDC quad\n    this.gl.bindBuffer(this.gl.ARRAY_BUFFER, quadVBO);\n    this.gl.enableVertexAttribArray(this.posAttributeIndex);\n\n    // 4 32-bit values = 4 4-byte values\n    this.gl.vertexAttribPointer(this.posAttributeIndex, 2, this.gl.FLOAT, false, 4 * 4, 0);\n\n    this.gl.enableVertexAttribArray(this.uvAttributeIndex);\n    this.gl.vertexAttribPointer(this.uvAttributeIndex, 2, this.gl.FLOAT, false, 4 * 4, 2 * 4);\n\n    this.gl.drawArrays(this.gl.TRIANGLE_STRIP, 0, 4);\n\n    if (fb) {\n      this.gl.bindFramebuffer(this.gl.FRAMEBUFFER, null);\n    }\n\n    this.frame++;\n  }\n\n  public getShaderSource(): string {\n    return this.shader;\n  }\n\n  public destruct() {\n    for (const k in this.textures) {\n      if (this.textures[k] instanceof ImageEffectRendererBuffer) {\n      } else {\n        this.gl.deleteTexture(this.textures[k] as WebGLTexture);\n      }\n    }\n    this.textures = [];\n\n    if (this.frameBuffer0) {\n      this.frameBuffer0.destruct();\n      this.frameBuffer0 = null;\n    }\n\n    if (this.frameBuffer1) {\n      this.frameBuffer1.destruct();\n      this.frameBuffer1 = null;\n    }\n  }\n\n  private getProgram(): WebGLProgram {\n    if (this.program === null) {\n      throw new Error('ImageEffectRenderer not initialized');\n    }\n\n    return this.program;\n  }\n}\n\nexport default class ImageEffectRenderer {\n  public static MAX_IMAGE_EFFECT_RENDERERS: number = 10;\n\n  // webgl\n  private canvas: HTMLCanvasElement;\n  private gl: WebGLRenderingContext;\n  private width: number = 0;\n  private height: number = 0;\n\n  // quad\n  private quadVBO!: WebGLBuffer;\n\n  // control\n  private requestAnimationID!: number;\n  private time: number = 0;\n\n  // (global) context resource management\n  private static IERActive: ImageEffectRenderer[] = [];\n  private static IERPool: ImageEffectRenderer[] = [];\n\n  private container: HTMLElement;\n  private animationLoop: boolean;\n\n  private canvasScale: number = 1;\n\n  private mainBuffer!: ImageEffectRendererBuffer;\n  private buffers: ImageEffectRendererBuffer[] = [];\n\n  /**\n   * Requires a HTMLCanvasElement and a shader program as a plain text string\n   *\n   * @param container\n   * @param shader\n   * @param _animationLoop\n   */\n  constructor(\n    container: HTMLElement,\n    animationLoop: boolean = false,\n    createTemporaryUsed: boolean = false,\n  ) {\n    if (!createTemporaryUsed) {\n      throw new Error('Use ImageEffectRenderer.createTemporary to create a ImageEffectRenderer');\n    }\n\n    this.container = container;\n    this.animationLoop = animationLoop;\n\n    this.canvas = document.createElement('canvas');\n    this.gl = this.canvas.getContext('experimental-webgl', {\n      premultipliedAlpha: true,\n    }) as WebGLRenderingContext;\n\n    if (!this.gl) {\n      throw new Error('ImageEffectRenderer: Failed to request a 3D context, aborting...');\n    }\n  }\n\n  /**\n   * Create a GL canvas object and stores it in a Pool because we can't have unlimited gl contexts.\n   *\n   * @param container: HTMLElement and the wrapper of the canvas. Canvas will size based on this element\n   * @param shader: Plain text shader that is applied\n   * @param animationLoop: Boolean to automatically play the animationFrame to update the canvas\n   * @param canvasScale: Number to scale up/down the real canvas size. Can be used to shrink the canvas and render\n   * less pixels, which should result in faster rendering.\n   */\n  public static createTemporary(\n    container: HTMLElement,\n    shader: string,\n    animationLoop: boolean = false,\n    canvasScale: number = 1,\n  ): ImageEffectRenderer {\n    let ier!: ImageEffectRenderer;\n\n    // before creating a context, determine if we already reached the maximum number of contexts\n    if (ImageEffectRenderer.IERActive.length >= ImageEffectRenderer.MAX_IMAGE_EFFECT_RENDERERS) {\n      throw new Error(\n        `Maximum number of ImageEffectRenderer's reached, no new ImageEffectRenderer created`,\n      );\n    }\n\n    // determine if there's an ImageEffectRenderer in the IERPool and if so, re-use its context\n    if (ImageEffectRenderer.IERPool.length > 0) {\n      // first look for same shader\n      let sameShaderFound = false;\n      for (let i = 0; i < ImageEffectRenderer.IERPool.length; i++) {\n        if (ImageEffectRenderer.IERPool[i].mainBuffer.getShaderSource() === shader) {\n          ier = ImageEffectRenderer.IERPool[i];\n          ImageEffectRenderer.IERPool.splice(i, 1);\n          sameShaderFound = true;\n        }\n      }\n      if (!sameShaderFound) {\n        ier = ImageEffectRenderer.IERPool[0];\n        ImageEffectRenderer.IERPool.splice(0, 1);\n      }\n    } else {\n      ier = new ImageEffectRenderer(container, animationLoop, true);\n    }\n\n    ier.animationLoop = animationLoop;\n    ier.container = container;\n    ier.canvasScale = canvasScale;\n    container.appendChild(ier.canvas);\n\n    if (!ier.quadVBO) {\n      ier.generateNDCQuad();\n    }\n\n    if (!ier.mainBuffer) {\n      ier.mainBuffer = new ImageEffectRendererBuffer(ier.gl);\n    }\n    ier.mainBuffer.compileShader(shader);\n\n    // gl configuration\n    ier.gl.clearColor(0, 0, 0, 0);\n    ier.gl.viewport(0, 0, ier.canvas.width, ier.canvas.height);\n    ier.gl.clear(ier.gl.COLOR_BUFFER_BIT);\n\n    ier.gl.enable(ier.gl.BLEND);\n    ier.gl.blendFunc(ier.gl.ONE, ier.gl.ONE_MINUS_SRC_ALPHA);\n\n    ier.width = ier.canvas.width;\n    ier.height = ier.canvas.height;\n\n    // store current ImageEffectRenderer in the list of active IERs\n    ImageEffectRenderer.IERActive.push(ier);\n\n    return ier;\n  }\n\n  /**\n   * Returns the Canvas Element\n   */\n  public getCanvas(): HTMLCanvasElement {\n    return this.canvas;\n  }\n\n  /**\n   * Play the animationFrame loop\n   */\n  public play(): void {\n    if (!this.requestAnimationID) {\n      this.animationLoop = true;\n      this.draw(0);\n    }\n  }\n\n  /**\n   * Stop the animationFrame loop\n   */\n  public stop(): void {\n    if (this.requestAnimationID) {\n      window.cancelAnimationFrame(this.requestAnimationID);\n      this.requestAnimationID = 0;\n      this.animationLoop = false;\n    }\n  }\n\n  /**\n   * Returns the RenderTime for the shader\n   */\n  public get renderTime(): number {\n    return this.time;\n  }\n\n  public getMainBuffer(): ImageEffectRendererBuffer {\n    return this.mainBuffer;\n  }\n\n  public addBuffer(\n    i: number,\n    shader: string,\n    type: number = WebGLRenderingContext.UNSIGNED_BYTE,\n  ): ImageEffectRendererBuffer {\n    if (this.buffers[i]) {\n      this.buffers[i].destruct();\n    }\n    this.buffers[i] = new ImageEffectRendererBuffer(this.gl, type);\n    this.buffers[i].compileShader(shader);\n    return this.buffers[i];\n  }\n\n  public getBuffer(i: number): ImageEffectRendererBuffer {\n    return this.buffers[i];\n  }\n\n  public updateSize(width: number, height: number): void {\n    this.canvas.width = width;\n    this.canvas.height = height;\n    this.canvas.style.width = `${width}px`;\n    this.canvas.style.height = `${height}px`;\n  }\n\n  private generateNDCQuad(): void {\n    // prettier-ignore\n    const vertices: Float32Array = new Float32Array([-1, 1, 0, 1, -1, -1, 0, 0, 1, 1, 1, 1, 1, -1, 1, 0]);\n    this.quadVBO = this.gl.createBuffer() as WebGLBuffer;\n    this.gl.bindBuffer(this.gl.ARRAY_BUFFER, this.quadVBO);\n    this.gl.bufferData(this.gl.ARRAY_BUFFER, vertices, this.gl.STATIC_DRAW);\n  }\n\n  /**\n   * Draw the new Canvas Frame, can be used to manually update the canvas when a Uniform has changed\n   *\n   * @param time\n   */\n  public draw(time: number = 0): void {\n    this.time = time / 1000;\n\n    // determine if screen has been resized. If so, adjust viewport\n    if (this.canvas.width !== this.width || this.canvas.height !== this.height) {\n      this.gl.viewport(0, 0, this.canvas.width, this.canvas.height);\n      this.width = this.canvas.width;\n      this.height = this.canvas.height;\n    }\n\n    // update buffers\n    for (const k in this.buffers) {\n      this.buffers[k].draw(this.quadVBO, this.time, this.canvas.width, this.canvas.height);\n    }\n\n    this.mainBuffer.draw(this.quadVBO, this.time, this.canvas.width, this.canvas.height);\n\n    if (this.animationLoop) {\n      this.requestAnimationID = window.requestAnimationFrame(time => this.draw(time));\n    }\n  }\n\n  public addImage(\n    image: HTMLImageElement | HTMLCanvasElement | HTMLVideoElement | ImageEffectRendererBuffer,\n    slotIndex: number,\n    clampHorizontal: boolean = true,\n    clampVertical: boolean = true,\n    flipY: boolean = false,\n    useMipMap: boolean = false,\n  ): void {\n    this.mainBuffer.addImage(image, slotIndex, clampHorizontal, clampVertical, flipY, useMipMap);\n  }\n\n  public updateImage(\n    image: HTMLImageElement | HTMLCanvasElement | HTMLVideoElement | ImageEffectRendererBuffer,\n    slotIndex: number,\n    clampHorizontal: boolean = true,\n    clampVertical: boolean = true,\n    flipY: boolean = false,\n    useMipMap: boolean = false,\n  ): void {\n    this.mainBuffer.updateImage(image, slotIndex, clampHorizontal, clampVertical, flipY, useMipMap);\n  }\n\n  /**\n   * Set a Uniform Floating variable used in the Shader\n   * @param name: string\n   * @param value: float\n   */\n  public setUniformFloat(name: string, value: number): void {\n    this.mainBuffer.setUniformFloat(name, value);\n  }\n\n  /**\n   * Set a Uniform Integer variable used in the Shader\n   * @param name: string\n   * @param value: Int\n   */\n  public setUniformInt(name: string, value: number): void {\n    this.mainBuffer.setUniformInt(name, value);\n  }\n\n  /**\n   * Set a Uniform Vec2 variable used in the Shader\n   * @param name: string\n   * @param value: Vec2\n   */\n  public setUniformVec2(name: string, x: number, y: number): void {\n    this.mainBuffer.setUniformVec2(name, x, y);\n  }\n\n  /**\n   * Set a Uniform Vec3 variable used in the Shader\n   * @param name: string\n   * @param value: Vec3\n   */\n  public setUniformVec3(name: string, x: number, y: number, z: number): void {\n    this.mainBuffer.setUniformVec3(name, x, y, z);\n  }\n\n  /**\n   * Set a Uniform Vec4 variable used in the Shader\n   * @param name: string\n   * @param value: Vec4\n   */\n  public setUniformVec4(name: string, x: number, y: number, z: number, w: number): void {\n    this.mainBuffer.setUniformVec4(name, x, y, z, w);\n  }\n\n  public destruct() {\n    for (const k in this.buffers) {\n      this.buffers[k].destruct();\n    }\n    this.buffers = [];\n    this.mainBuffer.destruct();\n  }\n\n  /**\n   * Release a temporary Canvas context from the pool. Freeing it up for other uses.\n   *\n   * @param ier\n   */\n  public static releaseTemporary(ier: ImageEffectRenderer): void {\n    ier.stop();\n    ier.destruct();\n\n    // @ts-ignore\n    ier.canvas.parentNode.removeChild(ier.canvas);\n\n    // remove from active IER instances\n    const index = ImageEffectRenderer.IERActive.indexOf(ier);\n    if (index > -1) {\n      ImageEffectRenderer.IERActive.splice(index, 1);\n    } else {\n      throw new Error(`Can't find the EffectRenderer in the active pool`);\n    }\n\n    // add current instance to pool\n    ImageEffectRenderer.IERPool.push(ier);\n  }\n}\n","export default \"#define SAMPLES 8\\n#define N(a) (a.yx*vec2(1,-1))\\n#define PI 3.14159265358979\\n\\nuniform vec2 _StructureOffset;\\n\\nvec2 getInput(vec2 pos) {\\n    return texture2D(iChannel2, pos/iResolution.xy).xy;\\n}\\n\\nvec2 getGradient(vec2 pos,float delta) {\\n    vec2 d=vec2(delta,0);\\n    return vec2(\\n        dot((getInput(pos+d.xy)-getInput(pos-d.xy)).xy,vec2(.333)),\\n        dot((getInput(pos+d.yx)-getInput(pos-d.yx)).xy,vec2(.333))\\n    )/delta;\\n}\\n\\nvec4 getNoise(vec2 pos) {\\n    return texture2D(iChannel1,pos * (1./256.));\\n}\\n\\nfloat getDist(vec2 pos) {\\n    return smoothstep(.9,1.1,length(getInput(pos))*.9+getNoise(pos*.2).x);\\n}\\n\\nfloat getBorder(vec2 p) {\\n    vec2 p0 = p, p1 = p;\\n    float border = 0., norm = 0.;\\n\\n    for(int i=0;i<SAMPLES;i++) {\\n        vec2 gr0 = getGradient(p0,2.);\\n        vec2 gr1 = getGradient(p1,2.);\\n\\n        float grl0 = clamp(10.*length(gr0),0.,1.);\\n        float grll = clamp(10.*length(gr1),0.,1.);\\n\\n        p0 += 3.8 *normalize(N(gr0));\\n        p1 -= 3.8 *normalize(N(gr1));\\n\\n        float fact = 1.-float(i)/float(SAMPLES);\\n        border += fact*mix(1.,getDist(p0)*2.,grl0);\\n        border += fact*mix(1.,getDist(p1)*2.,grll);\\n\\n        norm += fact;\\n    }\\n    border /= norm*2.;\\n\\n    return clamp(border+.1,0.,1.);\\n}\\n\\nvoid mainImage( out vec4 c, vec2 p ) {\\n  vec2 fc = p.xy;\\n  vec2 vUV = p/iResolution.xy;\\n\\n  float emb = getNoise(fc + .5 + _StructureOffset*256.).x - getNoise(fc - .5 + _StructureOffset*256.).x;\\n\\n  vec4 fragColor = texture2D(iChannel0, vUV);\\n  fragColor.rgb = clamp(fragColor.rgb, vec3(0), vec3(1));\\n  fragColor.rgb = pow(fragColor.rgb, vec3(.5));\\n\\n  vec3 r = (1.-fract(fragColor.rgb * vec3(1.,4.,4.) + .5));\\n  r = clamp(r*1.5-.4, vec3(0), vec3(1));\\n  r = pow(r, vec3(4.));\\n\\n  fragColor.rgb += r.rgb * .2 * (1.-fragColor.rgb);\\n\\n  vec3 col1 = vec3(240./255., 190./255., 220./255.);\\n  vec3 col2 = vec3(190./255., 190./255., 240./255.);\\n  vec3 col3 = vec3(170./255., 230./255., 170./255.);\\n\\n  vec4 inp = texture2D(iChannel2, vUV);\\n\\n  col1 = mix( col1, col1 * col1, .5*smoothstep(.1,.3, inp.y + inp.x));\\n  col2 = mix( col2, col2 * col2, .5*smoothstep(.1,.3, inp.y + inp.x));\\n  col3 = mix( col3, col3 * col3, smoothstep(.1,.3, inp.z));\\n\\n  vec3 col = (1.-col1) * fragColor.r + (1.-col2) * fragColor.g  + (1.-col3) * fragColor.b;\\n\\n  float b = 1.-getBorder(p);\\n  col *= 1. - .7 * pow(b, .5);\\n//  col *= 1. + pow(b, .5);\\n\\n  vec3 structure = texture2D(iChannel3, fc / 512. + _StructureOffset).rgb;\\n  col *= .4+.6*smoothstep(.7, .975, structure.r);\\n\\n  fragColor.rgb = 1.-col;\\n\\n  fragColor.a = 1.;\\n  fragColor.rgb *= 0.95 + 0.1 * emb;\\n\\n  c = fragColor;\\n}\"","export default \"uniform float _FrameReset;\\n\\nconst float _InputStrength = 0.075;\\nconst float _FadeOutStrength = 0.025;\\n\\nfloat hash13(vec3 p3) {\\n    p3  = fract(p3 * .1031);\\n    p3 += dot(p3, p3.yzx + 19.19);\\n    return fract((p3.x + p3.y) * p3.z);\\n}\\n\\nvec2 hash22(vec2 p) {\\n\\tvec3 p3 = fract(vec3(p.xyx) * vec3(.1031, .1030, .0973));\\n    p3 += dot(p3, p3.yzx+19.19);\\n    return fract((p3.xx+p3.yz)*p3.zy);\\n}\\n\\nvec4 getInput(vec2 pos) {\\n    vec4 inp = texture2D(iChannel2, pos / iResolution);\\n\\n    float s = inp.x;\\n\\n    inp.r = max(s > 0. ? .01 : 0., s * 2. - 1.);\\n    inp.g = min(s * 2., 1.);\\n    inp.b = inp.b;\\n\\n    inp.g = max(0., inp.g - inp.r);\\n\\n    return inp;\\n}\\n\\nvec4 sampleTex(vec2 pos) {\\n    vec4 src = texture2D(iChannel0, pos / iResolution);\\n    vec4 inp = getInput(pos);\\n\\n//    if (_FrameReset > .5) src.rg = mix(src.rg, inp.rg * _InputStrength, .5);\\n\\n    return mix(src, inp, inp * inp * _InputStrength);\\n}\\n\\nvoid mainImage(out vec4 c, vec2 p) {\\n    vec4 fragColor;\\n    vec2 fc = p.xy;\\n\\n    vec2 noise2 = texture2D(iChannel1, (floor(fc * 1.9) + 0.5) / 256.).xy;\\n    fc += (noise2 * 2.0 - 1.0) * 2.5;\\n\\n    vec3 v0 = sampleTex(fc + vec2(-1, 0)).rgb;\\n    vec3 v1 = sampleTex(fc + vec2(1, 0)).rgb;\\n    vec3 v2 = sampleTex(fc + vec2(0, -1)).rgb;\\n    vec3 v3 = sampleTex(fc + vec2(0, 1)).rgb;\\n\\n    vec3 avg = (v0 + v1 + v2 + v3) * 0.25;\\n    float wx = abs(v0.g - v1.g);\\n    float wy = abs(v2.g - v3.g);\\n\\n    fragColor.rgb = wx > wy ? mix(avg, (v0 + v1) * .5, .75) : mix(avg, (v2 + v3) * .5, .75);\\n//    fragColor.rgb = mix(fragColor.rgb, (v3 * 8. + v2 * 6. + v0 + v1) / 16., .5);\\n\\n    fragColor.rgb *= (1.-_FadeOutStrength);\\n    float h = hash13(vec3(p, iTime));\\n    fragColor.rgb = max(vec3(0.), fragColor.rgb - h*(1./256.));\\n    c = fragColor;\\n}\"","export default \"void mainImage( out vec4 c, vec2 p ) {\\n    vec4 fragColor;\\n    vec2 fc = p.xy / iResolution.xy;\\n    fc.y = 1.-fc.y;\\n\\n    float color = texture2D(iChannel0, fc).r;\\n    float mask = 1. - texture2D(iChannel1, fc).r;\\n    c = vec4(max(0.,1.-color), 0, mask * color, 1.);\\n}\"","import ImageEffectRenderer, { ImageEffectRendererBuffer } from './ImageEffectRender';\n\nimport blitShader from '../shaders/blit.glsl';\nimport dynamicsShader from '../shaders/dynamics.glsl';\nimport inputShader from '../shaders/input.glsl';\n\nimport imgNoise from '../images/shadertoyNoise.png';\nimport imgStructure from '../images/structure.jpg';\nimport imgEmpty from '../images/empty.jpg';\n\nexport default class WatercolorEffect {\n  private static SIMULATION_STEPS: number = 1;\n  private imageEffectRenderer: ImageEffectRenderer;\n  private frameReset: boolean = false;\n  private structureOffset: number[] = [0, 0];\n\n  private _loadState = false;\n  private _loadProgress = 0;\n\n  public get loadState() {\n    return this._loadState;\n  }\n\n  public set loadState(value: boolean) {\n    this._loadState = value;\n  }\n\n  public set loadProgress(progress: number) {\n    this._loadProgress = progress;\n  }\n\n  public get loadProgress(): number {\n    return this._loadProgress;\n  }\n\n  constructor(private canvasWrapper: HTMLElement) {\n    this.imageEffectRenderer = ImageEffectRenderer.createTemporary(\n      canvasWrapper as HTMLElement,\n      blitShader,\n      false,\n    );\n\n    this.imageEffectRenderer.getCanvas().style.pointerEvents = 'none';\n\n    this.imageEffectRenderer.addBuffer(0, inputShader);\n    this.loadImage(this.imageEffectRenderer.getBuffer(0), imgEmpty, 0);\n    this.loadImage(this.imageEffectRenderer.getBuffer(0), imgEmpty, 1);\n\n    for (let i = 0; i < WatercolorEffect.SIMULATION_STEPS; i++) {\n      this.imageEffectRenderer.addBuffer(i + 1, dynamicsShader);\n      this.imageEffectRenderer\n        .getBuffer(i + 1)\n        .addImage(this.imageEffectRenderer.getBuffer(Math.max(1, i)), 0);\n      this.loadImage(this.imageEffectRenderer.getBuffer(i + 1), imgNoise, 1);\n      this.imageEffectRenderer.getBuffer(i + 1).addImage(this.imageEffectRenderer.getBuffer(0), 2);\n      this.imageEffectRenderer.getBuffer(i + 1).setUniformFloat('_FrameReset', 0);\n    }\n\n    this.imageEffectRenderer.addImage(\n      this.imageEffectRenderer.getBuffer(WatercolorEffect.SIMULATION_STEPS),\n      0,\n    );\n\n    this.loadImage(this.imageEffectRenderer.getMainBuffer(), imgNoise, 1);\n    this.imageEffectRenderer.addImage(this.imageEffectRenderer.getBuffer(0), 2);\n    this.loadImage(this.imageEffectRenderer.getMainBuffer(), imgStructure, 3);\n\n    this.update(0);\n  }\n\n  public updateSize(width: number, height: number) {\n    this.imageEffectRenderer.updateSize(width, height);\n  }\n\n  private loadImage(buffer: ImageEffectRendererBuffer, url: string, slot: number) {\n    const image = new Image();\n    image.crossOrigin = 'Anonymous';\n    image.src = url;\n    image.onload = () => buffer.addImage(image, slot, false, false);\n  }\n\n  public updateInputCanvas(canvasInput: HTMLCanvasElement) {\n    this.imageEffectRenderer.getBuffer(0).updateImage(canvasInput, 1);\n  }\n\n  public updateNNCanvas(canvasNN: HTMLCanvasElement) {\n    this.imageEffectRenderer.getBuffer(0).updateImage(canvasNN, 0);\n    this.frameReset = true;\n  }\n\n  private update(time: number) {\n    window.requestAnimationFrame(time => this.update(time));\n\n    if (this.frameReset) {\n      this.structureOffset[0] = Math.random();\n      this.structureOffset[1] = Math.random();\n      this.frameReset = false;\n      this.imageEffectRenderer.getBuffer(1).setUniformFloat('_FrameReset', 1);\n    } else {\n      this.imageEffectRenderer.getBuffer(1).setUniformFloat('_FrameReset', 0);\n    }\n\n    this.imageEffectRenderer.setUniformVec2(\n      '_StructureOffset',\n      this.structureOffset[0],\n      this.structureOffset[1],\n    );\n\n    this.imageEffectRenderer.draw(time);\n  }\n}\n","import Loader from './Loader';\n\nexport default Loader;\n","import * as React from 'react';\nimport styles from './Loader.module.css';\n\ninterface Props {\n  progress: number;\n}\n\nconst Loader = ({ progress }: Props) => {\n  const isVisible = progress < 1;\n\n  if (!isVisible) {\n    return null;\n  }\n\n  return <div className={styles.root}>Loading {progress * 100}%</div>;\n};\n\nexport default Loader;\n","import Canvas from './Canvas';\n\nexport default Canvas;\n","import React, { createRef, useEffect, useState } from 'react';\nimport { CanvasAnimator, CanvasAnimatorEvent } from '../../lib/canvas-animator';\nimport {\n  OffscreenDrawableCanvas,\n  OffscreenDrawableCanvasEvent,\n} from '../../lib/OffscreenDrawableCanvas';\nimport { useDatGuiFolder, useDatGuiValue } from '../../lib/dat-gui';\nimport WatercolorEffect from '../../lib/watercolor-effect';\nimport { createCanvasFromImageData, debugDrawImageData, get2DContext } from '../../lib/canvas';\nimport Worker from '../../workers/nn.worker';\nimport styles from './Canvas.module.css';\nimport Loader from '../Loader';\nimport spinner from '../../images/spinner.png';\nimport classNames from 'classnames';\nimport { CANVAS_HEIGHT, CANVAS_WIDTH } from '../../settings';\n\ntype WorkerReturnType = ReturnType<typeof Worker>;\ntype Next = WorkerReturnType['next'];\n\ninterface Props {\n  width: number;\n  height: number;\n}\n\nconst Canvas = ({ width: canvasWidth, height: canvasHeight }: Props) => {\n  const [canvasAnimator, setCanvasAnimator] = useState<CanvasAnimator | null>(null);\n  const [drawableCanvas, setDrawableCanvas] = useState<OffscreenDrawableCanvas | null>(null);\n  const [loadingProgress, setLoadingProgress] = useState<number>(0);\n  const [isProcessing, setIsProcessing] = useState<boolean>(false);\n\n  const canvasFitContainerRef = createRef<HTMLDivElement>();\n  const [appWorker, setAppWorker] = useState<{\n    next: Next;\n  } | null>(null);\n  const folder = useDatGuiFolder('Neural net', false);\n\n  const frames = useDatGuiValue(folder, 20, 'Frames', 1, 100);\n  const additionalFrames = useDatGuiValue(folder, 40, 'Extra frames', 1, 100);\n  const additionalFramesStep = useDatGuiValue(folder, 1, 'Extra frames step', 1, 100);\n\n  const drawableFolder = useDatGuiFolder('Drawable canvas', false);\n  const brushSize = useDatGuiValue(drawableFolder, 5, 'brush size', 1, 100);\n  const maxStrokeLength = useDatGuiValue(drawableFolder, 200, 'max stroke length', 1, 1000);\n  const blur = useDatGuiValue(drawableFolder, 5, 'blur', 1, 100);\n\n  const [waterColorEffect, setWaterColorEffect] = useState<WatercolorEffect | null>(null);\n\n  useEffect(() => {\n    if (drawableCanvas !== null) {\n      drawableCanvas.brushSize = brushSize;\n      drawableCanvas.maxStrokeLength = maxStrokeLength;\n      drawableCanvas.blur = blur;\n    }\n  }, [brushSize, maxStrokeLength, blur, drawableCanvas]);\n\n  // update the size of the webgl canvas\n  useEffect(() => {\n    if (waterColorEffect !== null) {\n      waterColorEffect.updateSize(canvasWidth, canvasHeight);\n    }\n  }, [canvasWidth, canvasHeight, waterColorEffect]);\n\n  // update the size of the drawable canvas\n  useEffect(() => {\n    if (drawableCanvas !== null) {\n      drawableCanvas.eventScaleX = canvasWidth / CANVAS_WIDTH;\n      drawableCanvas.eventScaleY = canvasHeight / CANVAS_HEIGHT;\n    }\n  }, [canvasWidth, canvasHeight, drawableCanvas]);\n\n  // send frames from the animator to the webgl component\n  useEffect(() => {\n    if (waterColorEffect != null && canvasAnimator !== null) {\n      const listener = ({ data }: CanvasAnimatorEvent) => {\n        waterColorEffect.updateNNCanvas(data);\n        debugDrawImageData(get2DContext(data).getImageData(0, 0, data.width, data.height));\n      };\n\n      canvasAnimator.addEventListener(CanvasAnimatorEvent.types.UPDATE, listener);\n\n      return () => {\n        canvasAnimator.removeEventListener(CanvasAnimatorEvent.types.UPDATE, listener);\n      };\n    }\n  });\n\n  // create a new CanvasAnimator instance\n  useEffect(() => {\n    if (canvasAnimator === null) {\n      setCanvasAnimator(new CanvasAnimator(CANVAS_WIDTH, CANVAS_HEIGHT));\n    }\n  }, [canvasAnimator]);\n\n  // create new WebGL component instance\n  useEffect(() => {\n    if (waterColorEffect === null && canvasFitContainerRef.current !== null) {\n      setWaterColorEffect(new WatercolorEffect(canvasFitContainerRef.current));\n    }\n  }, [canvasFitContainerRef, waterColorEffect]);\n\n  // update the WebGL component with the new drawing\n  useEffect(() => {\n    if (drawableCanvas !== null && appWorker !== null && canvasAnimator !== null) {\n      const draw = ({ data }: OffscreenDrawableCanvasEvent) => {\n        debugDrawImageData(data);\n        if (waterColorEffect !== null) {\n          waterColorEffect.updateInputCanvas(createCanvasFromImageData(data).canvas);\n        }\n      };\n      drawableCanvas.addEventListener(OffscreenDrawableCanvasEvent.types.DRAW, draw);\n      return () => {\n        drawableCanvas.removeEventListener(OffscreenDrawableCanvasEvent.types.DRAW, draw);\n      };\n    }\n  }, [drawableCanvas, appWorker, waterColorEffect, canvasAnimator]);\n\n  // process the drawing in the NN when stroke is finished\n  useEffect(() => {\n    if (\n      drawableCanvas !== null &&\n      appWorker !== null &&\n      canvasAnimator !== null &&\n      waterColorEffect !== null\n    ) {\n      const finish = async ({ data }: OffscreenDrawableCanvasEvent) => {\n        setIsProcessing(true);\n        const nextFrames = await appWorker.next(\n          data,\n          frames,\n          additionalFrames,\n          additionalFramesStep,\n        );\n\n        // clear drawing image in WebGL\n        waterColorEffect.updateInputCanvas(\n          createCanvasFromImageData(drawableCanvas.getCurrentImage()).canvas,\n        );\n        canvasAnimator.addFrames(nextFrames);\n        canvasAnimator.animate();\n        setIsProcessing(false);\n      };\n      drawableCanvas.addEventListener(OffscreenDrawableCanvasEvent.types.DRAW_COMPLETE, finish);\n      return () => {\n        drawableCanvas.removeEventListener(\n          OffscreenDrawableCanvasEvent.types.DRAW_COMPLETE,\n          finish,\n        );\n      };\n    }\n  }, [\n    drawableCanvas,\n    appWorker,\n    waterColorEffect,\n    additionalFrames,\n    additionalFramesStep,\n    canvasAnimator,\n    frames,\n  ]);\n\n  // create a new OffscreenDrawableCanvas\n  useEffect(() => {\n    if (canvasFitContainerRef.current !== null && drawableCanvas === null) {\n      setDrawableCanvas(\n        new OffscreenDrawableCanvas(\n          canvasFitContainerRef.current,\n          CANVAS_WIDTH,\n          CANVAS_HEIGHT,\n          canvasWidth / CANVAS_WIDTH,\n          canvasHeight / CANVAS_HEIGHT,\n        ),\n      );\n    }\n  }, [waterColorEffect, canvasFitContainerRef, drawableCanvas, canvasWidth, canvasHeight]);\n\n  // initialize the NN worker and load the NN data\n  useEffect(() => {\n    (async () => {\n      if (appWorker === null && waterColorEffect !== null && !waterColorEffect.loadState) {\n        waterColorEffect.loadState = true;\n        const worker: any = Worker();\n\n        const listener = (event: MessageEvent) => {\n          if (event.data.type === 'progress') {\n            setLoadingProgress(event.data.value);\n            waterColorEffect.loadProgress = event.data.value;\n          }\n        };\n        worker.addEventListener('message', listener);\n\n        await worker.ready;\n        await worker.load();\n        worker.removeEventListener('message', listener);\n        setAppWorker({ next: worker.next });\n        waterColorEffect.loadState = false;\n      }\n    })();\n  }, [appWorker, waterColorEffect]);\n\n  return (\n    <div>\n      <div\n        ref={canvasFitContainerRef}\n        className={styles.canvasScaleContainer}\n        style={{\n          width: `${canvasWidth}px`,\n          height: `${canvasHeight}px`,\n        }}\n      >\n        <Loader progress={loadingProgress} />\n        <img\n          alt={''}\n          src={spinner}\n          className={classNames(styles.spinner, {\n            [styles.spinnerVisible]: isProcessing,\n          })}\n        />\n      </div>\n    </div>\n  );\n};\n\nexport default Canvas;\n","export const CANVAS_WIDTH = 512;\nexport const CANVAS_HEIGHT = 256;\nexport const CANVAS_GUTTER = 60;\n","import CustomCursor from './CustomCursor';\n\nexport default CustomCursor;\n","import React, { createRef, ReactNode, useCallback, useEffect, useState } from 'react';\nimport classNames from 'classnames';\nimport styles from './CustomCursor.module.css';\n\ninterface Props {\n  children: Array<ReactNode> | ReactNode;\n  cursorImage: string;\n  cursorOffsetX: number;\n  cursorOffsetY: number;\n}\n\ninterface Point {\n  x: number;\n  y: number;\n}\n\nconst CustomCursor = ({ children, cursorImage, cursorOffsetX, cursorOffsetY }: Props) => {\n  const rootRef = createRef<HTMLDivElement>();\n  const cursorRef = createRef<HTMLImageElement>();\n  const [isPointerVisible, setPointerVisible] = useState<boolean>(false);\n\n  const pointerMoveCallback = useCallback(\n    (event: PointerEvent) => {\n      if (cursorRef.current !== null) {\n        cursorRef.current.style.setProperty('left', `${event.offsetX + cursorOffsetX}px`);\n        cursorRef.current.style.setProperty('top', `${event.offsetY + cursorOffsetY}px`);\n      }\n    },\n    [cursorRef, cursorOffsetX, cursorOffsetY],\n  );\n\n  const pointerLeaveCallback = useCallback(() => {\n    setPointerVisible(false);\n  }, []);\n\n  const pointerEnterCallback = useCallback(() => {\n    setPointerVisible(true);\n  }, []);\n\n  useEffect(() => {\n    if (rootRef.current !== null) {\n      rootRef.current.addEventListener('pointermove', pointerMoveCallback);\n      rootRef.current.addEventListener('pointerleave', pointerLeaveCallback);\n      rootRef.current.addEventListener('pointerenter', pointerEnterCallback);\n    }\n  }, [rootRef, pointerMoveCallback, pointerLeaveCallback, pointerEnterCallback]);\n\n  return (\n    <div ref={rootRef} className={styles.root}>\n      <img\n        src={cursorImage}\n        ref={cursorRef}\n        alt={''}\n        className={classNames(styles.cursor, {\n          [styles.cursorVisible]: isPointerVisible,\n        })}\n      />\n      {children}\n    </div>\n  );\n};\n\nexport default CustomCursor;\n","import App from './App';\n\nexport default App;\n","import React, { RefObject, useCallback, useState } from 'react';\nimport Canvas from '../Canvas';\nimport { ScaleMode, useElementFit } from 'use-element-fit';\nimport { CANVAS_GUTTER, CANVAS_HEIGHT, CANVAS_WIDTH } from '../../settings';\nimport styles from './App.module.css';\nimport mute from '../../images/icons/mute.svg';\nimport unmute from '../../images/icons/unmute.svg';\nimport CustomCursor from '../CustomCursor';\nimport cursorImage from '../../images/cursor.svg';\n\nconst App = () => {\n  const [muted, setMuted] = useState<boolean>(false);\n  const toggleMute = useCallback(() => setMuted(!muted), [muted]);\n\n  const { ref: containerRef, width, height, x, y } = useElementFit(\n    CANVAS_WIDTH + CANVAS_GUTTER * 2,\n\n    CANVAS_HEIGHT + CANVAS_GUTTER * 2,\n    ScaleMode.CONTAIN,\n  );\n\n  return (\n    <div ref={containerRef as RefObject<HTMLDivElement>} className={styles.root}>\n      <div\n        className={styles.app}\n        style={{\n          width: `${width}px`,\n          height: `${height}px`,\n          top: `${y}px`,\n          left: `${x}px`,\n        }}\n      >\n        <div className={styles.header}>\n          <button onClick={toggleMute} className={styles.headerButton}>\n            {muted && <img src={unmute} alt={'unmute'} />}\n            {!muted && <img src={mute} alt={'mute'} />}\n          </button>\n\n          <div className={styles.headerMenu}>\n            <button className={styles.headerButton}>Share</button>\n            <button className={styles.headerButton}>About</button>\n            <a\n              href={'https://github.com/mediamonkslabs/brush-strokes-frontend'}\n              target={'_blank'}\n              className={styles.headerButton}\n            >\n              Source\n            </a>\n          </div>\n        </div>\n        <CustomCursor cursorImage={cursorImage} cursorOffsetX={0} cursorOffsetY={-35}>\n          <Canvas width={width - CANVAS_GUTTER * 2} height={height - CANVAS_GUTTER * 2} />\n        </CustomCursor>\n      </div>\n    </div>\n  );\n};\n\nexport default App;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './components/App';\n\nReactDOM.render(<App />, document.getElementById('root'));\n"],"sourceRoot":""}